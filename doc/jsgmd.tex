\documentclass{article}
\usepackage{hangul}
\include{netj}
\usepackage{fancyvrb}
\usepackage{epsfig}

\author{\shinjaeho (2004-23580)}
\title{유전알고리즘을 통한 지수귀문도 풀이 \\
  {\small 2005/봄 4541.681A 유전알고리즘 과제}
}
\date{2005년 6월 3일}

\begin{document}
\maketitle{}


\section{문제 정의}
\label{sec:prob}

지수귀문도는 조선시대 영의정을 지냈던 학자 최석정(1646-1715)이 고안한
마방진의 일종으로 동양 전래의 수학과 철학을 담은 숫자놀이이다.
육각형들이 맞물려 거북등처럼 생긴 모양에 각 육각형들의 꼭지점에 적힌
숫자들을 더한 값이 모두 같은 것을 지수귀문도라고 한다.  각 꼭지점에는
1부터 꼭지점 총수까지 서로 다른 수가 한 번씩 나타나야 한다.  그림
\ref{fig:jsgmd24ex}은 1부터 24까지의 숫자를 사용하여 만든
지수귀문도이다.

\begin{figure}[htbp]
  \centering
%% 그림으로 바꾸기
  \begin{minipage}{15em}
\begin{verbatim}
          1       8 
      9      22      15
     23      11      24 
  2      19       5      12
  4      16      14      13
     21      20      17 
      7      18      10
          3       6 
\end{verbatim}
  \end{minipage}
  \caption{1부터 24까지 사용한 지수귀문도}
  \label{fig:jsgmd24ex}
\end{figure}

최적화 연구실의 조사 결과 \cite{moon03ga}에 따르면 같은 문제라도
다양한
해가 존재한다.  16짜리 지수귀문도의 경우 임의로 만든 $2^{32}$개의
순열에서도 140,915 개의 해가 발견되었으며 통계적 추측에 따르면 16!
전체에 대해서는 약 6억 개의 서로 다른 해가 존재할 것으로 추정된다.
30짜리의 경우 각 육각형의 합이 79부터 107까지인 다양한 해들이
발견되었다.  특수한 형태의 지수귀문도에 대해서는 해를 찾는 특수한
방법이 알려져 있지만, 일반적인 형태에 대한 방법은 아직 모른다.
지수귀문도는 어려운 조합적 최적화 문제의 좋은 예이다.


%%%%%%%%%%%%%%%%%%%%%%%

\section{해결 방법}
\label{sec:sol}

\subsection{혼합형 유전 알고리즘}
\label{sec:gastruct}


\paragraph{개요}

지수귀문도를 최적화 문제로 표현하여 유전 알고리즘을 이용하여 풀기 위해
다음과 같은 적합도 함수 $f$를 사용한다.
\[
f = \frac{\mu}{N M} - \sigma^2
\] 여기서 \[
\begin{array}{cccl}
\mbox{육각형의 합들의 평균} 
& \mu &=& \sum_{i=1}^M H_i / M\\
\mbox{육각형들의 합의 표준편차}
& \sigma^2 &=& \sum_{i=1}^M (H_i - \mu)^2 / M \\
\mbox{꼭지점의 총 개수} & N \\
\mbox{육각형들의 총 개수} & M \\
i\mbox{번째 육각형의 합} & H_i
\end{array}
\]

위와 같은 적합도 함수를 사용하는 유전알고리즘의 전체적인 구조는 다음과
같다.
\begin{enumerate}
\item 
한 세대의 크기 $P$는 512이며 매 세대마다 절반인 $K=256$개 개의 자손을
만들어 교체한다.
\item 자손을 만드는 데 참여할 두 부모는 품질 비례 룰렛휠
방식을 사용하여 선택한다.
\item 2차원 내추럴 교차를 사용하여 자손을 생성한다.
\item $N/3$개의 유전자를 골라서 $1/2$의 확률로 그 값을 1만큼 높이거나
  낮추는 변이를 적용한다.
\item 변이까지 마친 후에 중복된 숫자가 나타나지 않도록 수선을 해준다.
\item 지역최적화를 적용한다.
\item 이렇게 만든 $K$개의 자손들을 현재 세대 중에서 나쁜 해들 $K$개와
  교체한다.  단, 나쁜 해들을 고를 때 $5/K$의 확률로 살려두기도 한다.
\item 위의 과정을 아래 조건이 만족될 때까지 반복한다.
  \begin{itemize}
  \item 육각형들의 합의 분산이 0인 해를 찾았고
    \begin{itemize}
    \item 그 해가 가장 적합도가 높거나
    \item 가장 적합도가 높은 해의 나이가 충분히 많은 경우(가령, $> 100 P
      / N$),
    \end{itemize}
  \item 가장 적합도가 높은 해가 $2000 P / N$번 넘게 반복되거나,
  \item 제한시간(24의 경우 1분, 54는 5분, 80은 15분, 110은 30분, 224는
    두 시간)이 지날 때까지.
  \end{itemize}
\end{enumerate}


\paragraph{선택 및 교체}

자손을 만드는 데 참여할 두 부모는 품질 비례 룰렛휠 방식으로 선택한다.
앞에서 언급한 함수 $f$를 통해 나온 적합도를 직접 사용하지 않고 아래와
같이 선택압 상수 $sp$로 보정하여 $[1, sp]$ 구간 내로 분포시킨다.
이렇게 보정한 적합도를 기준으로 선택 및 교체를 진행한다.
\[
f'_i = (sp - 1) \frac{f_i - f_w}{f_b - f_w} + 1
\] 여기서 \[
\begin{array}{ccl}
f_i &:& \mbox{$i$번째 해의 적합도} \\
f_w &:& \mbox{세대에서 가장 낮은 적합도} \\
f_b &:& \mbox{세대에서 가장 높은 적합도} \\
sp  &:& \mbox{선택압 조절 상수} \\
\end{array}
\]
선택압 상수 $sp$는 3으로 주어 가장 높은 적합도(3)가 가장 낮은 해(1)의
3배가 되도록 보정한다.  이렇게 보정한 적합도 $f'$을 가지고 $f'$의
크기에 비례해서 선택이 되도록, 0부터 $\sum f'$ 사이의 임의의 난수를
발생시켜 $\sum_{i=0}^j f'_i$이 그 난수보다 커지는 가장 작은 $j$를 찾아
$j$ 번째 염색체를 선택한다.  이러한 방법으로 서로 다른 두 부모를
선택한다.

만들어질 자손들을 교체할 해들을 고르기 위해서 $f'$를 기준으로 나쁜
해를
$K$개를 고른다.  이 때 너무 빠른 수렴을 막고 나쁜 해들에게도 기회를
주기 위해서, 세대 중에서 세대 내에서 $f'$이 작은 $K$개의 해들 중에서
$5/K$의 확률로 건너뛰어 그보다 높은 해들을 교체 대상으로 대신한다.


\paragraph{교차}

2차원 \emph{내추럴 교차(natural crossover)}를 사용한다.  꼭지점 단위로
전체 그림을 두 부분으로 가르기 위해 세로로 된 자름선을 정한다.
자름선을 기준으로 왼쪽은 첫 번째 부모로부터, 그리고 오른쪽은 두 번째
부모로부터 물려받는다.  가장 윗줄에서부터 내려오면서 현재 자름선의
위치를 양옆으로 3칸 이내로 움직이며 자름선을 그어나간다.  자름선은 각
줄의 가장 왼쪽 꼭지점의 왼쪽이나 가장 오른쪽 꼭지점의 오른쪽에도 올 수
있으므로 한쪽 부모에게서만 물려받는 것도 가능하다.

지수귀문도의 실제 그림을 바탕으로 교차를 하므로 각 꼭지점이 염색체의
어느 유전자로 표현했는가에 사실상 아무런 영향을 받지 않는다는 장점이
있다.  그러나 자름선을 3칸씩 가파르게 이동시키더라도 완전히 수평으로
자르는 것이 불가능하기 때문에 수평으로 하는 자름선을 하나 더 사용하는
등의 방법이 보완되어야 할 것이라 생각한다.


\paragraph{변이}

변이는 각 유전자를 1/3의 확률로 그 값을 1만큼 높이거나 낮춘다.
\cite{DBLP:conf/gecco/ChoeCM03}에서 사용하는 방식과 비슷하다.
두 꼭지점을 골라 바꾸기도 하고 임의의 육각형을 골라 돌리기도 하였으나
교란이 너무 강해서 공간탐색을 방해하는 것으로 보여 제외시켰다.


\paragraph{수선}

교차와 변이 후에 같은 숫자를 가지는 유전자가 염색체 내에 있을 수
있으므로 중복되는 숫자를 찾아 그 \emph{순서를 보존하면서 재배열}을
한다.  처음에는 사용되지 않은 숫자를 임의로 골라 바꿔주는 작업을
하였는데, 이것이 해집단을 매우 불안정하게 만들어 문제공간의 탐색에
방해가 되는 사실을 알 수 있었다.




\subsection{지수귀문도의 육각형 모양 분석}
\label{sec:enc}

여기서 다루려는 모든 지수귀문도는 위아래와 양옆으로 선대칭이며, 맨
위와
아래에 $A$개의 육각형이 있고 가운데에는 $B$개의 육각형이 있다 ($A \le
B$).  윗부분에서 각 줄에 있는 육각형의 수는 그 윗줄보다 하나씩
늘어나며
아랫부분에서는 하나씩 줄어든다.  모두 $2(B-A)+1$줄이 있으며 각
줄에서는
최소 $A$개, 최대 $B$개의 육각형이 있다.  $i \in \{0, 1, \cdots,
2(B-A)\}$로 줄을 나타내고 $j \in \{0, 1, \cdots, B-|B-A-i|-1\}$로 그
줄에서 몇 번째 육각형인지를 나타내면 $i, j$를 가지고 지수귀문도의 모든
육각형들을 지칭할 수 있다. (그림 \ref{fig:jsgmd-layout} 참조)

\begin{figure}[htbp]
  \centering
  \begin{minipage}{0.83\linewidth}
\begin{verbatim}
   i                         B-|B-A-i| = cols(i)      
------------------------------------------------------
   0         o o . . o           A     = cols(0)
   1        o o . . . o         A+1    = cols(1)
   .       . . . . . . .         .     = .
   .      . . . . . . . .        .     = .
  B-A    o o . . . . . . o       B     = cols(B-A)
 B-A+1    o o . . . . . o       B-1    = cols(B-A+1)
   .       . . . . . . .         .     = .
   .        . . . . . .          .     = .
2*(B-A)      o o . . o           A     = cols(2*(B-A))
\end{verbatim}
  \end{minipage}
  \caption{지수귀문도에서 각 줄과 육각형의 개수}
  \label{fig:jsgmd-layout}
\end{figure}


지수귀문도에서 한 육각형의 각 꼭지점들이 인접한 어떤 육각형의
꼭지점들과 겹치는지 파악하였다.  우선 $i, j$로 지칭한 한 육각형에서 각
꼭지점은 왼쪽 위부터 시계방향으로 차례로 0, 1, 2, 3, 4, 5로 가리킨다.
(그림 \ref{fig:hexptidx} 참조)
\begin{figure}[htbp]
  \centering
%% 그림으로 바꾸기
  \begin{minipage}{5em}
\begin{verbatim}
    1
0       2
5       3
    4
\end{verbatim}
  \end{minipage}
  \caption{꼭지점 번호}
  \label{fig:hexptidx}
\end{figure}
한 꼭지점은 최대 3개의 인접한 육각형과 공유될 수 있다.  이어질
내용에서
육각형 $i, j$의 $k$번째 꼭지점은 $i_1, j_1$과 $i_2, j_2$가 각각 유효한
육각형을 가리킬 때 $i_1, j_1$의 $k_1$번째와 $i_2, j_2$의 $k_2$번째와
같다고 하여 그 관계를 파악해보았다.

$i < B-A$인 경우,
\[
\begin{array}{c|ccc|ccc}
k & i_1&j_1&k_1& i_2&j_2&k_2\\
\hline
0 & i-1&j-1&4  & i+0&j-1&2  \\
1 & i-1&j+0&2  & i-1&j-1&3  \\
2 & i+0&j+1&0  & i-1&j+0&4  \\
3 & i+1&j+1&1  & i+0&j+1&5  \\
4 & i+1&j+0&2  & i+1&j+1&0  \\
5 & i+0&j-1&3  & i+1&j+0&1
\end{array}
\]

$i = B-A$인 경우,
\[
\begin{array}{c|ccc|ccc}
k & i_1&j_1&k_1& i_2&j_2&k_2\\
\hline
0 & i-1&j-1&4  & i+0&j-1&2  \\
1 & i-1&j+0&2  & i-1&j-1&3  \\
2 & i+0&j+1&0  & i-1&j+0&4  \\
3 & i+1&j+0&1  & i+0&j+1&5  \\
4 & i+1&j-1&2  & i+1&j+0&0  \\
5 & i+0&j-1&3  & i+1&j-1&1
\end{array}
\]

$i > B-A$인 경우,
\[
\begin{array}{c|ccc|ccc}
k & i_1&j_1&k_1& i_2&j_2&k_2\\
\hline
0 & i-1&j+0&4  & i+0&j-1&2  \\
1 & i-1&j+1&2  & i-1&j+0&3  \\
2 & i+0&j+1&0  & i-1&j+1&4  \\
3 & i+1&j+0&1  & i+0&j+1&5  \\
4 & i+1&j-1&2  & i+1&j+0&0  \\
5 & i+0&j-1&3  & i+1&j-1&1
\end{array}
\]

세 경우를 한꺼번에 표현하면,
\[
\begin{array}{c||c|cccc|c||c|cccc|c}
k &  i_1 & j_1&L&0&H  &k_1&  i_2 & j_2&L&0&H  &k_2\\
\hline
0 &  i-1 & j&-1&-1&+0 &4  &  i+0 & j&-1&-1&-1 &2  \\
1 &  i-1 & j&+0&+0&+1 &2  &  i-1 & j&-1&-1&+0 &3  \\
2 &  i+0 & j&+1&+1&+1 &0  &  i-1 & j&+0&+0&+1 &4  \\
3 &  i+1 & j&+1&+0&+0 &1  &  i+0 & j&+1&+1&+1 &5  \\
4 &  i+1 & j&+0&-1&-1 &2  &  i+1 & j&+1&+0&+0 &0  \\
5 &  i+0 & j&-1&-1&-1 &3  &  i+1 & j&+0&-1&-1 &1
\end{array}
\]

이를 $i = B-A$일 때 $j$와 현재 $i$가 가리키는 줄이 지수귀문도의 가운데
줄보다 위인지 아래인지를 나타내는 $L$, $H$를 가지고 나타내면 표
\ref{tab:hexrel}과 같은 관계를 얻을 수 있다.

\begin{table}[htbp]
\centering
\[
\begin{array}{cc}
  L = (i < B-A)\; ?\; 1 : 0 &
  H = (i > B-A)\; ?\; 1 : 0
\end{array}
\]
\[
\begin{array}{c|ccc|ccc}
k & i_1&j_1  &k_1 & i_2&j_2  &k_2\\
\hline
0 & i-1&j-1+H&4   & i+0&j-1+0&2  \\
1 & i-1&j+0+H&2   & i-1&j-1+H&3  \\
2 & i+0&j+1+0&0   & i-1&j+0+H&4  \\
3 & i+1&j+0+L&1   & i+0&j+1+0&5  \\
4 & i+1&j-1+L&2   & i+1&j+0+L&0  \\
5 & i+0&j-1+0&3   & i+1&j-1+L&1
\end{array}
\]
\caption{지수귀문도에서 각 꼭지점을 공유하는 육각형들}
\label{tab:hexrel}
\end{table}

지수귀문도의 육각형 모양에 대한 분석 결과를 바탕으로, 사실상
지수귀문도
자체를 하나의 자연스러운 염색체로 생각할 수 있게 되었다.  표
\ref{tab:hexrel}을 이용하여 어떠한 유전자 배치에 대해서도 적용이
가능한
일반적인 연산을 구현하는 것이 가능하다.  지수귀문도에서 각 육각형의
꼭지점이 유전자의 어디에 위치하는지를 대응시키는 배열을 만들어두면
되기
때문이다.  유전자 배치에 의존하는 연산들을 특정한 유전자 배치로부터
독립시킴으로써, 육각형들의 합 구하기, 2차원 교차, 교란 등을 쉽게
구현할 수 있었다.  더불어 유전자 배치를 쉽게 바꾸어 수행을 할 수
있는 유연한 체계를 갖출 수 있었다.  

이런 유연한 체계를 가지고 유전자 배치 실험도 해볼 수 있을 것이다.  표
\ref{tab:hexrel}을 이용하면 임의의 유전자 배치도 쉽게 만들어낼 수
있다.  각 꼭지점들이 실제로 저장되는 배열을 1차원 염색체로 보고, N점
교차 등 유전자 배치와 밀접한 관계가 있는 연산과 가장 잘 어울리는 좋은
유전자 배치가 무엇인지 찾는 데에 큰 도움이 될 수 있을 것이라
생각한다.  더불어 유전알고리즘 수행 도중에 유전자 배치를 바꾸어가며
좋은 스키마들의 생존 확률을 높이는 것도 가능해진다.


\paragraph{표현}

현재는 가장 왼쪽 위 육각형부터 오른쪽으로 가고 줄 별로 내려가면서, 각
육각형의 왼쪽 위 꼭지점부터 시계방향으로 돌면서 검사하여, 유전자
위치가
할당이 되지 않았으면 순서대로 번호를 주는 식으로 유전자 배치를 한다.
이 과정에서 표 \ref{tab:hexrel}을 이용하여 같은 꼭지점을 나타내는 $i$,
$j$, $k$에 모두 동일한 유전자 번호를 할당할 수 있다.  가령, 24짜리의
경우에는 $A=2, B=3$으로 그림 \ref{fig:encoding24}과 같으며, 54, 80,
110, 224의 경우 $A=3$과 각각 $B=5, 6, 7, 9$으로 놓고 같은 방식으로
유전자 배치를 하였다.

\begin{figure}[htbp]
  \centering
  \begin{minipage}{15em}
\begin{verbatim}
          1       6 
      0       2       7     
      5       3       8 
 10       4       9       16
 13      11      14       17
     12      15      18
     21      19      22     
         20      23 
\end{verbatim}
  \end{minipage}
  \caption{24짜리의 유전자 배치}
  \label{fig:encoding24}
\end{figure}



\subsection{지역최적화 및 휴리스틱}
\label{sec:localopt}

\paragraph{꼭지점 바꾸기로 적합도 올리기}

새로 만든 염색체를 세대로 집어넣기 전에 두 유전자들을 바꿔치기하여
적합도를 최대로 만드는 지역최적화를 하였다.  즉, 매 자손 염색체가
만들어지고 교체를 하기 직전에 각 유전자들의 자리를 바꿨을 때 적합도가
더 높아지는가를 확인하여 그럴 경우에는 바꿔주었다.  이 과정을 모든
유전자 쌍들에 대해서 더 이상 적합도가 높아질 수 없을 때까지
진행하였다.

이 방법은 한 염색체의 모든 유전자 쌍마다 적합도를 다시 계산해야 한다.
새 적합도를 계산하기 위해서는 모든 육각형들의 합의 평균 $\mu$와 제곱의
합의 평균 $\bar{H_i^2}$을 구해야 한다.  그러나 한 쌍의 유전자를 바꿨을
경우만 고려하므로, 사실상 이 두 유전자가 속한 육각형을 제외하고는 합과
제곱의 합이 변하지 않는다.

불필요한 계산은 가급적 건너뛰고 변화되는 양만을 고려하여 적합도를
효율적으로 계산한다.  한 유전자, 즉 한 꼭지점이 공유될 수 있는
육각형은 최대 3개이다.  따라서 두 유전자를 서로 바꿔치기 했을 때, 최대
6개의 육각형의 합만이 변할 수 있다.  이 사실을 이용하여 육각형들의
합과 제곱의 합을 변화량만을 가지고 다음과 같이 효율적으로 계산할 수 있다.

위의 지역최적화를 보다 효율적으로 하기 위하여 적합도의 개선 정도에
한계를 두거나 인접한 바꿔치기를 하였다.  전자를 통해서 아주 나쁜
해들을
불필요하게 최적화 하는 것을 방지할 수 있었다.  그런데
\cite{DBLP:conf/gecco/ChoeCM03}에서 소개하는 \emph{인접한 바꿔치기
  (consecutive exchange)}를 사용할 경우, 위와 같이 최대한 바꿔치기를
하는 것과 비슷한 효과를 내면서도 효율이 더 좋아 이를 채용하였다.


\paragraph{나이}

각 해들을 시간이 지남에 따라 적합도를 떨어뜨려 보다 넓은 탐색이
가능하게 하였다.  모든 해의 나이는 한 세대가 지남에 따라 1씩
증가한다.  해의 나이가 $a$일 때, 그 해의 보정된 적합도 $f'$을 다음과
같이 보정하여 나이가 반영된 적합도 $f''$을 얻는다.
\[
f'' = f' - \frac{N}{10 P} a
\]
$f'$ 대신에 $f''$을 이용하여 선택 및 교체를 진행하였다.


\paragraph{교란}

세대가 수렴하는 문제를 해결하기 위해 수렴 정도가 심하면 해들을 교란
시키는 방법을 썼다.  세대의 분산의 평균과 가장 좋은 해의 분산의 차이가
$0.005$보다 작은 것이 $K/2$회 이상 반복되면, 세대 중 $1/4$을 선택하여
다음과 같은 두 교란 방법을 적용한다.  첫 번째는 임의로 두 유전자를
골라
바꿔치기 하는 것이다.  유전자 쌍을 최대 둘까지 골라서 바꿔치기 해준다.
두 번째는 육각형을 임의로 선택하여 회전을 시키는 방법이다.  선택한
육각형의 각 꼭지점을 1에서 5칸 시계방향으로 회전시킨다.  회전 역시
최대
두 육각형까지 한다.


\paragraph{유전자 재배치}

유전자 배열을 무작위로 시작하여 가장 좋은 해의 개선이 별로 없을 경우에
새로운 유전자 배치를 가지고 진행하는 방법을 사용해보았다.  새 배치를
임의로 생성한 뒤에 기존 배치에 맞게 저장된 해들을 새 배치에 맞게
바꾸고 진행한다.  그러나 유전자 배치에 독립적인 2차원 교차를 사용하기
때문에 이는 별로 의미가 없어서 심각하게 사용하지는 않았다.



%%%%%%%%%%%%%%%%%%%%%%%

\section{구현}
\label{sec:impl}

C언어로 구현하였으며 중복되는 계산이 최소가 되도록 심혈을 기울여
만들었다.  반복되는 다수의 코드는 매크로를 이용하여 간소화 하였다.
\texttt{alarm()}을 이용하여 전체 수행 시간 제한을 두었으며,
\texttt{SIGINT}와 \texttt{SIGQUIT}을 받아서 현재 세대의 상황과 가장
좋은 해를 출력하도록 만들어 성능에 저하를 주지 않으면서도 진행상황을
점검하기 쉽게 하였다.  pthread 라이브러리를 이용하여 각 자손을
만들어내는 부분처럼 독립적인 계산은 3개의 일꾼 쓰레드가 담당하게 하여
병렬화 하였다.


\subsection{가속하기}
\label{sec:accel}

계산을 가속하기 위한 몇몇 아이디어를 사용하였다.  새로운 자손을 부모와
교체할 때 적합도, 평균, 분산 등 항상 전체를 새로 계산하지 않고 변하는
양만큼을 가감하여 기록해 계산양이 최소가 되도록 하였다.  자손과 세대
내의 해 사이의 포인터 바꿔치기만으로 교체를 하여 염색체의 복사로
생기는
비효율을 최대한 줄였다.  표준편차를 계산할 때 효율적으로 하기 위해서
분산을 다음과 같이 제곱의 평균과 평균의 제곱을 이용하여 계산하였다.
\[
\sigma^2 = \bar{H_i^2} - \bar{H_i}^2
\]

\paragraph{변이 가속}

한 염색체 내에서 $1/3$의 확률로 유전자를 골라 변이를 시키기 위해서
$N/3$개를 뽑아 변이를 시켰다.  항상 서로 다른 $N/3$개의 유전자가
선택되도록 하기 위하여 다음 유전자의 위치를 난수로 발생시킬 때,
뽑아야할 남은 개수 만큼을 반드시 남겨두고, 하나를 뽑은 다음에는 반드시
그 다음 칸에서부터 선택하도록 하였다.  $N$개의 해들 각각에 대해서
난수를 발생시켜 $1/3$의 확률로 가감을 하는 경우 반드시 $N$번의 반복이
필요한 반면, 이렇게 할 경우 $N/3$번의 반복만 하면 되므로 3배가 빨라진다.


\paragraph{바꾸기로 적합도 올리기 가속}

적합도를 비교해가면서 각 꼭지점 쌍을 바꾸는 지역최적화에서
매번 적합도를 계산해야 한다.  그런데 바뀌는 꼭지점은 둘 뿐이므로
대부분의 육각형의 합은 변하지 않는다.  따라서 적합도 계산에 필요한
육각형들의 합 및 제곱의 합을 매번 다시 계산하는 것을 대단히
비효율적이다.  두 꼭지점을 바꿀 경우 합이 변하는 육각형들만 다시
계산하면서 지역최적화를 가속할 수 있는 방법을 고안하였다.

우선, 바꿔치기 했을 때의 적합도를 알아볼 두 유전자 $x$와 $y$를
생각하자.  $x$를 꼭지점으로 가지는 육각형들의 꼭지점의 합을 각각
$H_i$라 하고, $y$를 가지는 육각형들을 $H_j$라 하자.  적합도를 계산하기
위해서 평균과 분산이 필요하므로, 염색체가 나타내는 모든 육각형들의 합
$S$와 제곱의 합 $SS$가 필요하다.  $x$나 $y$가 속하지 않은 육각형들은
그
합 및 제곱이 변하지 않으므로, $x$나 $y$가 속한 육각형들만을 고려해도
된다.  즉, $S$와 $SS$를 다음과 같이 놓고 이들의 변화만을 고려해도
된다.
\[
\begin{array}{rcl}
\delta &=& y - x \\
S &=& \sum H_i + \sum H_j \\
SS &=& \sum H_i^2 + \sum H_j^2
\end{array}
\]
이제, $H_i$들에 들어있는 $x$를 $H_j$들에 들어있는 $y$와 바꾸면, 각
$H_i$는 $y-x$만큼 커지고, $H_j$는 $x-y$만큼 커진다.  $y-x$를
$\delta$로 놓으면, 관계된 모든 육각형들의 새 합 $S'$와 새 제곱의 합
$SS'$은 다음과 같다.
\[
\begin{array}{rcl}
S' &=& \sum (H_i+\delta) + \sum (H_j-\delta) \\
SS' &=& \sum (H_i+\delta)^2 + \sum (H_j-\delta)^2
\end{array}
\]
한 꼭지점을 공유하는 육각형은 최대 3개이지만, 둘레 쪽으로 가면 2개
또는
1개까지 될 수 있다.  $x$를 공유하는 육각형 $H_i$들이 $m$개이고, $y$를
공유하는 육각형 $H_j$들이 $n$개라고 해보자.  만약 $x$와 $y$가 인접한
경우라면, 이들을 공유하는 육각형이 겹칠 수도 있다, 즉 원래부터 같은
육각형에 속한 꼭지점인 경우다.  이 경우에는 바꿔치기를 하더라도 해당
육각형의 합이나 제곱의 합은 변하지 않는다.  이렇게 겹치는 육각형의
수는 $c$개라고 해보자.  그러면 $S'$와 $SS'$는 다음과 같이 원래의 $S$,
$SS$와 함께 그 변화량을 가지고 나타낼 수 있다.
\[
\begin{array}{rcl}
S' &=& \sum^{m-c} (H_i+\delta) + \sum^{n-c} (H_j-\delta) \\
&=& \sum H_i + \sum^{m-c} \delta + \sum H_j - \sum^{n-c} \delta \\
&=& \sum H_i + \sum H_j + \sum^{m-c} \delta - \sum^{n-c} \delta \\
&=& S + \sum^{m-c} \delta - \sum^{n-c} \delta \\
&=& S + (m-c) \delta - (n-c) \delta \\
&=& S + (m-n) \delta \\
\\
SS' &=& \sum^{m-c} (H_i+\delta)^2 + \sum^{n-c} (H_j-\delta)^2 \\
&=& \sum^{m-c} (H_i^2 + 2 \delta H_i + \delta^2) + \sum^{n-c} (H_j^2 - 2 \delta H_j + \delta^2) \\
&=& \sum H_i^2 + 2 \delta \sum H_i + \sum^{m-c} \delta^2
  + \sum H_j^2 - 2 \delta \sum H_j + \sum^{n-c} \delta^2 \\
&=& \sum H_i^2 + \sum H_j^2
+ 2 \delta \sum H_i - 2 \delta \sum H_j
+ \sum^{m-c} \delta^2 + \sum^{n-c} \delta^2 \\
&=& SS + 2 (\sum H_i - \sum H_j) \delta + \sum^{m+n-2c} \delta^2 \\
&=& SS + (2 (\sum H_i - \sum H_j) + (m+n-2c) \delta) \delta 
\end{array}
\]
따라서 기존의 합 $S$와 제곱의 합 $SS$, 그리고 현재 유전자 $x$와 $y$에
관계된 $n, m, c, \sum H_i, \sum H_j$를 알면, 새 합 $S'$과 제곱의 합
$SS'$을 바로 알 수 있으며 적합도 또한 바로 따라 나온다.  만약 $S'$와
$SS'$으로부터 나오는 적합도가 더 크다면 바꿔치기를 한다.  바꿔치기를
하면 관계된 육각형들의 합이 바뀌므로, $H_i$와 $H_j$들만 각각
$\delta$를
가감해주면 된다.  따라서, 염색체가 나타내는 모든 육각형들의 합을 맨
처음에만 기록해두고 위와 같이 매 바꿔치기에서 변화되는 육각형들만
조정해가면서 지역최적화를 진행할 수 있다.  매번 적합도를 계산할 때
필요한 모든 육각형들의 합과 제곱의 합도 마찬가지로 처음에만 계산을
해두고, 매 바꿔치기마다 그 변화량 $(m-n) \delta$와 $(2 (\sum H_i -
\sum H_j) + (m+n-2c) \delta) \delta$ 값만을 계속 더해주면서 그 변화를
유지해가면 된다.



%%%%%%%%%%%%%%%%%%%%%%%

\section{실험 결과}
\label{sec:exp}

앞서 설명한 구현을 가지고 Pentium4 3.2GHz, 4GB 메모리를 가진 기계에서
Linux 2.6 커널 위에서 실험하였다.  문제 풀이 실험의 결과는 표
\ref{tab:exp.result}에 나와있다.  24짜리의 경우는 엄청나게 빠른 속도로
해를 찾으며 54 이상의 경우도 최대 적합도가 10
이상씩 올라갔음을 확인할 수 있다.

54, 80, 110짜리에서 찾은 가장 좋은 해들의 그림은 각각
\ref{fig:exp.best54}, \ref{fig:exp.best80}, \ref{fig:exp.best110}과
같다.  224 이상에서는 아직 해를 찾지 못했다.  80짜리 및 110짜리의 해를
찾는 실험 하나를 골라 세대가 지남에 따라서 세대 내의 해들의 평균
적합도와 최대 적합도, 평균 분산과 가장 좋은 해의 분산이 어떻게
변하는지를 그림 \ref{fig:exp.runplot80} 및 \ref{fig:exp.runplot110}과
같이 그려보았다.  5번째 이전은 분산이 너무 크고, 1000번째 이후는
변화를 관찰하기 어려워 5번부터 1000번 세대 사이만 그렸다.

\begin{table}[htbp]
  \centering
  \begin{tabular}{r|rrrrr}
$N$     &해 수    &평균 적합도    &최대 적합도    &\small 평균 수행 시간 &평균 세대 수   \\
\hline
24      &3228     &76.87825       &85.00000       &0.03s                 &12.72          \\
54      &198      &178.62932      &190.00000      &18.90s                &819.55         \\
80      &184      &268.61760      &281.00000      &248.62s               &6419.08        \\
110     &104      &372.23091      &381.00000      &1049.55s              &19756.41       \\
224     &1        &744.90783      &744.90783      &14293.58s             &89660.00       \\
\end{tabular}
\caption{실험 결과}
\label{tab:exp.result}
\end{table}

\begin{figure}[htbp]
  \centering
  \begin{minipage}{25em}
\begin{verbatim}
             15      14       9
         28      40      36      18
         23      37      38      43
      7      47      25      46       5
     54      17      29      11      34
 16      42      35      41      51       1
 13      45      27      32      33      19
     20      24      26      22      52
      4      44      21      50       3
         53      48      39      30
          6      31      49      10
              8       2      12
\end{verbatim}
  \end{minipage}
  \caption{54짜리에서 찾은 가장 좋은 해. (합 190)}
  \label{fig:exp.best54}
\end{figure}

\begin{figure}[htbp]
  \centering
  \begin{minipage}{29em}
\begin{verbatim}
                 19       3      14  
             22      53      60      13  
             47      69      63      65  
         12      71      33      66       5   
         39      37      28      51      30  
      6      75      43      40      64      21   
     56      35      50      72      31      57  
 15      70      41      48      23      78       1
 11      74      27      54      25      80      20
     55      34      61      59      44      45
     17      77      36      42      73       7
         24      46      29      38      32
          4      68      26      79      10
             62      76      67      49
              8      58      52      16
                  9       2      18 
\end{verbatim}
  \end{minipage}
  \caption{80짜리에서 찾은 가장 좋은 해. (합 281)}
  \label{fig:exp.best80}
\end{figure}

\begin{figure}[htbp]
  \centering
  \begin{minipage}{33em}
\begin{verbatim}
                     24       4      21
                 27      64      78      16
                 76      96      99      57
             14      94      40     110      11
             44      61      42      35      62
         13      92      48      55     106       1
         47      85      65      84      75      32
      5     100      30      87      26     105       3
     72      50      80      31      90      56      81
 18     107      36      88      63      29     104       2
 22      91      37      74      79      51     102      10
     71      60      66      46      69      39      82
      9      97      38      89      28     108      17
         53      83      68      70      86      33
          6      93      54      59      95       7
             49      45      41      43      52
              8     109      34     101      23
                 77      98     103      67
                 20      58      73      25
                     19      15      12
\end{verbatim}
  \end{minipage}
  \caption{110짜리에서 찾은 가장 좋은 해. (합 381)}
  \label{fig:exp.best110}
\end{figure}


\begin{figure}[htbp]
  \centering
  \epsfig{file=exp-runplot-80-init,width=\linewidth}
  \caption{80짜리를 풀 때 세대 변화}
  \label{fig:exp.runplot80}
\end{figure}

\begin{figure}[htbp]
  \centering
  \epsfig{file=exp-runplot-110-init,width=\linewidth}
  \caption{110짜리를 풀 때 세대 변화}
  \label{fig:exp.runplot110}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%% 

\section{결론 및 고찰}
\label{sec:conclusion}

순수 유전알고리즘만 가지고도 지수귀문도의 꼭지점 수가 24인 경우에는
대부분 답을 쉽게 찾아낸다.  그러나 54짜리부터는 세대 안의 해들이
분산을
빠른 속도로 낮추어 지역해로 이동은 하지만, 공간 특성상 별로 매력이
크지
않은 한 지역해에 걸려서 수렴한 후 실제 해로 쉽게 올라가지 못한다.
적합도를 고려하여 두 꼭지점을 바꾸는 지역최적화 및 나이, 교란 등의
휴리스틱을 사용하여 순수 유전 알고리즘만으로는 찾지 못하는 54짜리
이상에서도 해를 구할 수 있었다.  54짜리는 190, 80짜리는 281, 110짜리는
381의 합을 갖는 지수귀문도를 찾았다.


\subsection{고찰}
\label{sec:discuss}

온갖 방법을 통해서 해 찾기에 도전해보았지만 번번히 실패했다.  그러다가
무작위로 하던 수선을, 순서를 보존하는 방식으로 바꾸어보니 해를 매우 잘
찾기 시작했다.  이것은 유전 알고리즘이 랜덤하게 해를 찾는 것이 아니라
교차에 매우 의존하여, 정말로 유전을 통해서 문제공간을 탐색하는
것이라는
사실을 암시한다고 생각한다.  뿐만 아니라 지역최적화, 변이 등 다른 유전
알고리즘 연산자도 마찬가지로 유전이 제대로 되지 않게 교란을 시키면
유전
알고리즘 전체가 제대로 동작하지 않는다는 사실을 발견했다.  유전
알고리즘이 무작위로 공간 탐색하는 것과 다를 바가 없을거라는 편견이
있었는데, 본 과제를 통해서 정말로 \emph{유전}을 통해서 문제를 접근하는
알고리즘임을 확인할 수 있었다.


\subsection{앞으로의 계획}

2차원 교차를 수평 뿐만 아니라 수직으로도 자르면 좀 더 다양한 공간을
탐색할 수 있을 것으로 보인다.
유전자 배치 실험을 통해 좋은 스키마가 보존되는 유전자 배치를 찾아보는
것도 좋겠다.
보통 한 두 개의 육각형의 합을 맞추지 못해서 허덕이는데, 이를 해결할 수
있는 지역최적화를 추가하면 큰 도움이 될 것으로 보인다.
적합도 함수를 고르기가 매우 까다로운데 합과 분산 각각을 최적화하기위한
복수의 목적함수를 두어 진행하는 것도 좋을 것 같다.




\bibliography{papers}
\bibliographystyle{plain}

\newpage
\appendix

\section{프로그램 소스코드}

\VerbatimInput[fontfamily=cmtt,
baselinestretch=1,
fontsize=\footnotesize,
numbers=left]
{../jsgmd.c}

\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
